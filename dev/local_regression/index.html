<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Local regression · SyntheticLikelihood.jl</title><link rel="canonical" href="https://danielward27.github.io/SyntheticLikelihood.jl/local_regression/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">SyntheticLikelihood.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../examples/ricker/">Example</a></li><li class="is-active"><a class="tocitem" href>Local regression</a><ul class="internal"><li><a class="tocitem" href="#Example"><span>Example</span></a></li><li><a class="tocitem" href="#Bayesian-inference"><span>Bayesian inference</span></a></li><li><a class="tocitem" href="#Currently-available-&quot;objectives&quot;"><span>Currently available &quot;objectives&quot;</span></a></li></ul></li><li><a class="tocitem" href="../samplers/">Samplers</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Local regression</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Local regression</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/danielward27/SyntheticLikelihood.jl/blob/master/docs/src/local_regression.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Local-regression"><a class="docs-heading-anchor" href="#Local-regression">Local regression</a><a id="Local-regression-1"></a><a class="docs-heading-anchor-permalink" href="#Local-regression" title="Permalink"></a></h1><p>Local regressions can be used to estimate the gradient and hessian of the likelihood, which can be used to improve the sampling efficieny of synthetic likelihood.</p><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><p>Here we consider a simple example, in which we infer the mean of a 10-dimensional multivariate normal distribution, using simulations from the distribution.</p><h4 id="Define-the-simulator"><a class="docs-heading-anchor" href="#Define-the-simulator">Define the simulator</a><a id="Define-the-simulator-1"></a><a class="docs-heading-anchor-permalink" href="#Define-the-simulator" title="Permalink"></a></h4><p>The simulator must take a single positional argument, which is the parameter vector:</p><pre><code class="language-">using SyntheticLikelihood, Distributions, Plots

# Define the simulator
function simulator(θ::Vector{Float64})
  @assert length(θ) == 10
  d = MvNormal(θ, sqrt(0.1))
  rand(d)
end

nothing # hide</code></pre><h4 id="Ground-truth"><a class="docs-heading-anchor" href="#Ground-truth">Ground truth</a><a id="Ground-truth-1"></a><a class="docs-heading-anchor-permalink" href="#Ground-truth" title="Permalink"></a></h4><p>The &quot;true&quot; parameters which we will aim to estimate, is just a vector of zeros. We can use this to generate a pseudo-observed data set <code>s_true</code>.</p><pre><code class="language-">θ_true = zeros(10)
s_true = simulator(θ_true)</code></pre><h4 id="Defining-how-to-estimate-the-likelihood"><a class="docs-heading-anchor" href="#Defining-how-to-estimate-the-likelihood">Defining how to estimate the likelihood</a><a id="Defining-how-to-estimate-the-likelihood-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-how-to-estimate-the-likelihood" title="Permalink"></a></h4><p>We can then define the hyperparameters for estimating the likelihood using local regression using <a href="#SyntheticLikelihood.LocalLikelihood"><code>LocalLikelihood</code></a>.</p><pre><code class="language-">local_likelihood = LocalLikelihood(;
  simulator, s_true,
  P = MvNormal(fill(0.5, 10)),
  n_sim = 1000
)
nothing # hide</code></pre><p>Note that if required a <code>summary</code> function can optionally be specified here, to summarise the output of the <code>simulator</code>.</p><h4 id="Defining-sampling-method"><a class="docs-heading-anchor" href="#Defining-sampling-method">Defining sampling method</a><a id="Defining-sampling-method-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-sampling-method" title="Permalink"></a></h4><p>We can then define how to sample from the distribution. Below I will use the <a href="../samplers/#SyntheticLikelihood.RiemannianULA"><code>RiemannianULA</code></a> sampler with a step size of 0.1.</p><pre><code class="language-julia">rula = RiemannianULA(0.1)</code></pre><h4 id="Sampling"><a class="docs-heading-anchor" href="#Sampling">Sampling</a><a id="Sampling-1"></a><a class="docs-heading-anchor-permalink" href="#Sampling" title="Permalink"></a></h4><p>We can now define some initial parameter values, <code>init_θ</code>, and sample from the distribution using <a href="../samplers/#SyntheticLikelihood.run_sampler!"><code>run_sampler!</code></a>:</p><pre><code class="language-">init_θ = convert(Vector{Float64}, 1:10)
data = run_sampler!(rula, local_likelihood; init_θ, n_steps = 500)
nothing # hide</code></pre><h4 id="Plot-the-samples"><a class="docs-heading-anchor" href="#Plot-the-samples">Plot the samples</a><a id="Plot-the-samples-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-the-samples" title="Permalink"></a></h4><pre><code class="language-">param_names = reshape([&quot;θ$i&quot; for i in 1:10], (1,10))
plot(data.θ, label = param_names)</code></pre><p>We can see that after the burn in period, samples are generally centered around the true parameter values (all zeros). More specifically, they are centered around <code>s_true</code> in this case, which are generally around zero.</p><h2 id="Bayesian-inference"><a class="docs-heading-anchor" href="#Bayesian-inference">Bayesian inference</a><a id="Bayesian-inference-1"></a><a class="docs-heading-anchor-permalink" href="#Bayesian-inference" title="Permalink"></a></h2><p>Given a prior, it is also simple to sample from the posterior instead of the likelihood. The prior should be specified using the distributions from <a href="https://juliastats.org/Distributions.jl/stable/"><code>Distributions.jl</code></a>. A multivariate distribution can be used, or alternatively the prior can be formed from independent univariate priors using a <code>Product</code> distribution from Distributions.jl. For this example the prior is a multivariate normal centered around 5, with no correlation structure, and σ=0.5:</p><pre><code class="language-julia">prior = MvNormal(fill(5, 10), 0.5)</code></pre><p>We can then define our objective using <a href="#SyntheticLikelihood.LocalPosterior"><code>LocalPosterior</code></a> and run the sampler again:</p><pre><code class="language-">local_posterior = LocalPosterior(prior, local_likelihood)
data = run_sampler!(rula, local_posterior; init_θ, n_steps = 500)
plot(data.θ, label = param_names)</code></pre><p>Note internally, this uses <a href="#SyntheticLikelihood.LocalLikelihood"><code>LocalLikelihood</code></a> to estimate the the gradient and Hessian of the likelihood as before, and then uses automatic differentiation of the prior to get the gradient and Hessian of the prior. These can then be used to calculcate the gradient and Hessian of the posterior.</p><h2 id="Currently-available-&quot;objectives&quot;"><a class="docs-heading-anchor" href="#Currently-available-&quot;objectives&quot;">Currently available &quot;objectives&quot;</a><a id="Currently-available-&quot;objectives&quot;-1"></a><a class="docs-heading-anchor-permalink" href="#Currently-available-&quot;objectives&quot;" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="SyntheticLikelihood.LocalLikelihood" href="#SyntheticLikelihood.LocalLikelihood"><code>SyntheticLikelihood.LocalLikelihood</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Contains the hyperparameters for getting a local approximation of the negative log-likelihood surface using local regressions.</p><ul><li><p><code>simulator</code></p></li><li><p><code>summary</code></p></li><li><p><code>s_true</code></p></li><li><p><code>P</code></p><p>Initial distribution used to peturb the parameter value.</p></li><li><p><code>n_sim</code></p><p>The number of peturbed points to use for the local regression.</p></li><li><p><code>P_regularizer</code></p><p>Method to regularise the inverse Hessian to a reasonable covariance matrix.</p></li><li><p><code>valid_params</code></p><p>Parameter constraints. Function that takes a parameter vector and returns true (for valid parameters) or false (for invalid parameters). Defualt is θ -&gt; true</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/danielward27/SyntheticLikelihood.jl/blob/23cf97b906e407dda2f21d957935669d4f1d4572/src/local_approximation_structs.jl#L3-L8">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SyntheticLikelihood.LocalPosterior" href="#SyntheticLikelihood.LocalPosterior"><code>SyntheticLikelihood.LocalPosterior</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Contains the hyperparameters for getting a local approximation of the posterior. In contrast to the likelihood version, a prior is provided, P is by defualt a MvNormal with covariance 0.5*cov(prior), and  valid_params checks whether proposed points fall within the prior support.</p><ul><li><p><code>prior</code></p><p>Prior distribution (either multivariate or Product distribution)</p></li><li><p><code>simulator</code></p></li><li><p><code>summary</code></p></li><li><p><code>s_true</code></p></li><li><p><code>P</code></p></li><li><p><code>n_sim</code></p></li><li><p><code>P_regularizer</code></p></li><li><p><code>valid_params</code></p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/danielward27/SyntheticLikelihood.jl/blob/23cf97b906e407dda2f21d957935669d4f1d4572/src/local_approximation_structs.jl#L28-L35">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../examples/ricker/">« Example</a><a class="docs-footer-nextpage" href="../samplers/">Samplers »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Saturday 17 April 2021 17:19">Saturday 17 April 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
